<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Your Divine Blueprint</title>

  <!-- Luxury skin + components -->
  <style>
  :root{
    --ink:#1b1d20; --sub:#3c434a; --paper:#fbfaf7; --card:#ffffff;
    --gold:#c5a25a; --golder:#ae8b46; --muted:#7a838c;
  }

  html,body{height:100%}
  body{
    margin:0; color:var(--ink);
    font:16px/1.7 Georgia, "Times New Roman", serif;
    -webkit-font-smoothing:antialiased; text-rendering:optimizeLegibility;
    background:#0e1220; /* fallback behind video */
  }

  /* === Animated background: video + aurora + stars === */
  .as-bg{
    position:fixed; inset:0; z-index:-1; pointer-events:none;
  }
  .as-bg-video{
    position:absolute; inset:0; width:100%; height:100%; object-fit:cover;
    opacity:.35; filter:saturate(1.05) contrast(1.05) brightness(.9) blur(2px);
  }
  .as-bg::before,
  .as-bg::after{
    content:""; position:absolute; inset:-20%; mix-blend-mode:multiply; filter:blur(22px);
  }
  .as-bg::before{
    background:
      radial-gradient(40% 32% at 30% 30%, rgba(174,139,70,.18), transparent 60%),
      radial-gradient(45% 36% at 70% 60%, rgba(197,162,90,.16), transparent 65%);
    animation: driftA 28s linear infinite;
  }
  .as-bg::after{
    background:
      radial-gradient(36% 30% at 70% 35%, rgba(197,162,90,.14), transparent 60%),
      radial-gradient(40% 34% at 35% 70%, rgba(174,139,70,.12), transparent 65%);
    animation: driftB 36s linear infinite;
  }
  .as-bg-stars{
    position:absolute; inset:0; opacity:.25; animation: twinkle 3.6s ease-in-out infinite;
    background:
      radial-gradient(1px 1px at 12% 22%, rgba(197,162,90,.55), transparent 60%),
      radial-gradient(1px 1px at 72% 32%, rgba(197,162,90,.45), transparent 60%),
      radial-gradient(1px 1px at 42% 68%, rgba(197,162,90,.55), transparent 60%),
      radial-gradient(1px 1px at 86% 54%, rgba(197,162,90,.45), transparent 60%),
      radial-gradient(1px 1px at 24% 78%, rgba(197,162,90,.5), transparent 60%);
  }
  @keyframes driftA {
    0%   { transform: translate3d(-4%, -2%, 0) rotate(0deg) scale(1.02); }
    50%  { transform: translate3d(6%, 3%, 0) rotate(180deg) scale(1.04); }
    100% { transform: translate3d(-4%, -2%, 0) rotate(360deg) scale(1.02); }
  }
  @keyframes driftB {
    0%   { transform: translate3d(4%, 2%, 0) rotate(0deg) scale(1.03); }
    50%  { transform: translate3d(-6%, -3%, 0) rotate(-180deg) scale(1.05); }
    100% { transform: translate3d(4%, 2%, 0) rotate(-360deg) scale(1.03); }
  }
  @keyframes twinkle { 0%,100% { opacity:.15 } 50% { opacity:.35 } }
  @media (prefers-reduced-motion: reduce){
    .as-bg-video{ display:none !important; }
    .as-bg::before, .as-bg::after, .as-bg-stars { animation: none; }
  }
  @media print{ .as-bg{ display:none !important } }

  /* Layout + card */
  .as-wrap{max-width:860px; margin:28px auto; padding:0 20px}
  .as-card{
    position:relative; overflow:hidden;
    background:var(--card); border-radius:22px; padding:26px 30px 34px;
    box-shadow:0 24px 48px rgba(0,0,0,.06); border:1px solid rgba(197,162,90,.25);
  }
  .as-card:before{
    content:""; position:absolute; inset:0; pointer-events:none;
    background:linear-gradient(180deg, rgba(197,162,90,.16), rgba(197,162,90,0) 160px);
    mix-blend-mode:multiply;
  }
  .as-card:after{
    content:""; position:absolute; inset:0; pointer-events:none; opacity:.18;
    background:
      radial-gradient(1px 1px at 15% 25%, #bfa46a 50%, transparent 51%),
      radial-gradient(1px 1px at 75% 35%, #bfa46a 50%, transparent 51%),
      radial-gradient(1px 1px at 45% 70%, #bfa46a 50%, transparent 51%);
  }

  .as-header{text-align:center; padding:8px 0 14px}
  .as-crest{width:72px; height:72px; margin:6px auto 8px; color:var(--gold)}
  .as-kicker{letter-spacing:.18em; text-transform:uppercase; font-size:12px; color:var(--golder)}
  .as-title{font:600 34px/1.25 "Garamond","Georgia",serif; margin:6px 0 8px; color:var(--ink)}
  .as-sub{color:var(--sub); font-size:15px}
  .as-divider{display:flex; align-items:center; gap:12px; justify-content:center; margin:20px auto 0; color:var(--gold)}
  .as-divider::before,.as-divider::after{content:""; height:1px; flex:1; background:linear-gradient(90deg,transparent,var(--gold),transparent)}

  .as-card h2{font:600 22px/1.35 "Garamond","Georgia",serif; color:var(--ink); margin:16px 0 8px}
  .as-card p{margin:8px 0; color:#23262a; line-height:1.75}
  .as-muted{color:var(--muted)}
  .as-section{margin:18px 0 8px}

  .as-callout{border:1px solid rgba(197,162,90,.45); border-radius:14px; padding:14px 16px;
              background:linear-gradient(180deg,#fff,#fffaf0)}
  .as-grid{display:grid; grid-template-columns:repeat(2,minmax(0,1fr)); gap:14px; margin:8px 0 6px}
  .as-pill{border:1px solid rgba(0,0,0,.08); border-radius:12px; padding:10px 12px; background:#fff}
  .as-pill b{color:var(--golder)}
  .as-card a{color:var(--ink); text-decoration:none; border-bottom:1px solid rgba(197,162,90,.55)}
  .as-card a:hover{color:#ae8b46}

  .as-ritual{border:1px solid rgba(197,162,90,.35); border-radius:18px; padding:16px 18px;
    background:linear-gradient(180deg,#fff,#fffaf5); margin:18px 0}
  .as-mini{border:1px solid rgba(197,162,90,.35); border-radius:16px; padding:16px 18px;
    background:linear-gradient(180deg,#fff,#fffaf5); margin:18px 0}
  .as-ritual h3, .as-mini h3{display:flex; align-items:center; gap:10px; margin:0 0 10px;
    font:600 18px/1.35 "Garamond","Georgia",serif; color:#1b1d20}
  .as-ico{width:18px; height:18px; color:#ae8b46}
  .as-bullets{margin:10px 0 8px; padding-left:20px}
  .as-bullets li{margin:6px 0}
  .as-note{border-left:3px solid rgba(197,162,90,.6); padding:10px 12px; margin:10px 0 0;
    background:linear-gradient(90deg, #fffef9, #ffffff)}

  .as-cta{display:inline-block; margin-top:8px; padding:10px 16px; border-radius:999px;
    border:1px solid rgba(197,162,90,.55); text-decoration:none; color:#1b1d20;
    background:linear-gradient(180deg,#fff,#fff8ed)}
  .as-cta:hover{color:#ae8b46}
  .as-subtle-link{display:inline-block; margin-left:12px; font-size:14px; color:#6b7280;
    border-bottom:1px solid rgba(0,0,0,.15); text-decoration:none}
  .as-subtle-link:hover{color:#ae8b46; border-color:#ae8b46}
  .as-more{margin-top:10px}
  .as-more-toggle{background:none; border:0; color:#ae8b46; cursor:pointer; padding:0; font:inherit}
  .as-hidden{display:none}
  .as-rule{height:1px; background:linear-gradient(90deg,transparent,#c5a25a,transparent); margin:16px 0}

  /* --- Gift / Need --- */
  .gift-box,.need-box{
    border:1px solid rgba(197,162,90,.45);
    border-radius:14px; padding:14px 16px; background:linear-gradient(180deg,#fff,#fffaf7);
    margin:12px 0;
  }
  .gift-icon{display:inline-flex; align-items:center; justify-content:center;
    width:26px; height:26px; border-radius:999px; margin-right:8px;
    border:1px solid rgba(197,162,90,.55); color:#ae8b46; font-size:14px;
    background:linear-gradient(180deg,#fff,#fff6e6);} 
  .gift-box p{margin:6px 0;}
  .gift-affirm{font-style:italic; color:#6b7280; margin-top:6px}

  /* Energy meter (softened & centered) */
  .energy-bar{height:8px; border-radius:999px; overflow:hidden; background:#f4f1ea; margin:12px auto 12px; width:min(420px,78%)}
  .bar-left{height:100%; float:left; background:linear-gradient(90deg,#e9f3ff,#dceeff)}
  .bar-right{height:100%; float:right; background:linear-gradient(90deg,#ffddcf,#ffd0ba)}

  /* Chips */
  .as-chips{display:flex; flex-wrap:wrap; gap:8px; margin:10px 0}
  .as-chip{font-size:12px; padding:6px 10px; border:1px solid rgba(197,162,90,.45);
    border-radius:999px; background:#fffdf7}

  /* Premium remedy layout */
  .as-remedy{border:1px solid rgba(197,162,90,.35); border-radius:16px; padding:14px 16px; background:linear-gradient(180deg,#fff,#fffaf7); margin:12px 0}
  .as-remedy-head{display:flex; align-items:center; gap:10px; flex-wrap:wrap}
  .as-badge{display:inline-flex; align-items:center; gap:8px; padding:10px 14px; border:1px solid rgba(197,162,90,.6); border-radius:999px; background:linear-gradient(180deg,#fff,#fffaf0); font-weight:600}
  .as-badge svg{width:16px; height:16px; color:#ae8b46}

  @media print{
    body{background:#fff}
    .as-wrap{margin:0; padding:0}
    .as-card{box-shadow:none; border:0; border-radius:0}
    .as-card a{color:#000; border-bottom:1px solid #000}
  }
  </style>
</head>
<body>

  {% set result = result if result is defined else {} %}
  {% set maha_frag = maha_frag | default('') %}
  {% set anta_frag = anta_frag | default('') %}

  <!-- Background: video + aurora + stars -->
  <div class="as-bg" aria-hidden="true">
    <video class="as-bg-video" autoplay muted loop playsinline preload="none">
      <source src="{{ url_for('static', filename='bg-aurora.mp4') }}" type="video/mp4">
    </video>
    <div class="as-bg-stars"></div>
  </div>

  <div class="as-wrap">
    <article class="as-card">

      <!-- Header -->
      <header class="as-header">
        <svg class="as-crest" viewBox="0 0 64 64" fill="none" aria-hidden="true">
          <path d="M32 8l2.9 8.8h9.3L36.7 23l2.9 8.8L32 26.6l-7.6 5.2L27.3 23l-7.6-6.2h9.3L32 8z" stroke="currentColor" stroke-width="1.4"/>
          <path d="M12 36c3.5-1 8-3.6 10.5-8.2M10 42c-4.8-.6 10.2-3 13.6-7.8M9 48c-5.7.1 12.2-2.3 16.4-7.7" stroke="currentColor" stroke-width="1.2" stroke-linecap="round"/>
          <path d="M52 36c-3.5-1-8-3.6-10.5-8.2M54 42c-4.8-.6-10.2-3 13.6-7.8M55 48c-5.7.1-12.2-2.3-16.4-7.7" stroke="currentColor" stroke-width="1.2" stroke-linecap="round"/>
        </svg>
        <div class="as-kicker">Ayoura Sky • Signature Reading</div>
        <h1 class="as-title">Your Divine Blueprint</h1>
        <div class="as-sub">Uniquely Aligned with the Cosmos</div>
        <div class="as-divider">◆</div>
      </header>

      <!-- Intro -->
      <section class="as-section">
        <p>{{ result.get('intro_paragraph','') }} {{ (result.get('life_path_fomo') or '') | safe }}</p>
      </section>

      <!-- Elemental Profile (cleaned) -->
      <section class="as-section">
        <h2>Elemental Profile</h2>

        <div class="as-mini">
          <!-- REMOVED tag row (e.g., 'Air soul • Current: Fire') -->

          <h3>
            <svg class="as-ico" viewBox="0 0 24 24" fill="none" aria-hidden="true">
              <circle cx="12" cy="12" r="8.5" stroke="currentColor"/>
              <path d="M7 14c2-1 4-1 6 0s4 1 6 0" stroke="currentColor" stroke-linecap="round"/>
            </svg>
            ✦ Your {{ result.get('birth_element','') }} Element at a Glance
          </h3>

          <!-- Gift (customer-centric copy) -->
          {% set be = result.get('birth_element','') %}
          <div class="gift-box">
            <div style="display:flex; align-items:flex-start;">
              <span class="gift-icon" aria-hidden="true">✦</span>
              <div>
                <p><strong>Strength you carry:</strong> Your natural <strong>{{ be }}</strong> gifts shape how you think, feel and create.</p>
                <p class="gift-affirm">
                  {% if be == 'Air' %}You thrive on clarity, connection and curiosity — conversations open doors for you.
                  {% elif be == 'Fire' %}You spark courage, momentum and transformation — your presence ignites action.
                  {% elif be == 'Water' %}You lead with empathy, intuition and grace — people feel safe around you.
                  {% elif be == 'Earth' %}You bring steadiness, discernment and devotion — you make ideas real.
                  {% else %}You hold vision, stillness and quiet knowing — you sense the path before it appears.{% endif %}
                </p>
              </div>
            </div>
          </div>

          <!-- Planetary shift (kept). REMOVED the element → element pill row. Kept + softened energy meter. -->
          {% set ce = result.get('current_element','') %}
          <div class="need-box">

            <!-- energy meter -->
            <div class="energy-bar" role="presentation">
              <div class="bar-left" style="width:50%"></div>
              <div class="bar-right" style="width:50%"></div>
            </div>

            <p><strong>Planetary Shift:</strong> As per planetary calculations, you’re currently experiencing <strong>{{ ce }}</strong> influence, which can:</p>
            <ul>
              {% if ce == 'Fire' %}
                <li>Fuel bold action — but risk impulsivity when rushed.</li>
                <li>Heighten emotional reactivity under stress.</li>
                <li>Push transformation faster than your nervous system prefers.</li>
              {% elif ce == 'Air' %}
                <li>Accelerate ideas — yet scatter focus across too many threads.</li>
                <li>Increase overthinking and decision fatigue.</li>
                <li>Favor speed over depth, diluting follow-through.</li>
              {% elif ce == 'Water' %}
                <li>Deepen empathy — while blurring boundaries.</li>
                <li>Amplify moods and nostalgia.</li>
                <li>Slow momentum through rumination.</li>
              {% elif ce == 'Earth' %}
                <li>Stabilize routines — but resist necessary change.</li>
                <li>Over-index on caution and control.</li>
                <li>Create heaviness or stagnation.</li>
              {% else %}
                <li>Expand vision — yet detach from practical steps.</li>
                <li>Invite stillness that can drift into inaction.</li>
                <li>Prefer the ethereal over the embodied.</li>
              {% endif %}
            </ul>
          </div>

          <!-- Premium Remedy block -->
          <div class="as-remedy">
            <div class="as-remedy-head">
              <strong>Your Remedy:</strong>
              <span class="as-badge" aria-label="Recommended fragrance">
                <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
                  <path d="M10 3h4M12 3v5l5 8a4 4 0 0 1-3.4 6H10.4A4 4 0 0 1 7 16l5-8" stroke="currentColor"/>
                </svg>
                {{ (result.get('fragrance_inspired_name') or '') | striptags }}
              </span>
            </div>
            <p style="margin:6px 0 8px">A grounding blend that turns passion into purpose and intensity into clarity.</p>

            <div class="as-chips">
              <span class="as-chip">Centers breath &amp; focus</span>
              <span class="as-chip">Softens reactivity</span>
              <span class="as-chip">Guides action with calm</span>
            </div>

            <!-- CTAs (respect fallback) -->
            <p style="margin-top:6px">
              {% if result.get('fragrance_url') %}
                <a class="as-cta" href="{{ result.get('fragrance_url') }}" target="_blank" rel="noopener">Explore Blend</a>
                <a class="as-subtle-link" href="{{ result.get('fragrance_url') }}#details" target="_blank" rel="noopener">Learn more about this blend</a>
              {% else %}
                <span class="as-cta">{{ (result.get('fragrance_inspired_name') or '') | striptags }}</span>
              {% endif %}
            </p>
          </div>

          <!-- REMOVED numbered usage steps intentionally -->

          <!-- Read more toggle (long-form copy) -->
          <div class="as-more">
            <button class="as-more-toggle" type="button"
              onclick="this.nextElementSibling.classList.toggle('as-hidden'); this.textContent = this.textContent.includes('Read') ? 'Hide full insight' : 'Read full insight';">
              Read full insight
            </button>
            <div class="as-hidden">
              <div class="as-callout" style="margin-top:10px">
                <p>{{ (result.get('elemental_intro') or '') | safe }}</p>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Planetary Flow -->
      <section class="as-section">
        <h2>Planetary Flow &amp; Fragrance-Led Ritual</h2>

        <div class="as-grid">
          <div class="as-pill"><b>Mahadasha:</b> {{ result.get('mahadasha','') }}
            <span class="as-muted">({{ result.get('mahadasha_start','') }} – {{ result.get('mahadasha_end','') }})</span>
          </div>
          <div class="as-pill"><b>Antardasha:</b> {{ result.get('antardasha','') }}
            <span class="as-muted">({{ result.get('antardasha_start','') }} – {{ result.get('antardasha_end','') }})</span>
          </div>
        </div>

        <p class="as-muted"><b>Guidance:</b> {{ result.get('dasha_guidance','') }}</p>

        <!-- Mahadasha ritual card -->
        <div class="as-ritual">
          <h3>
            <svg class="as-ico" viewBox="0 0 24 24" fill="none" aria-hidden="true">
              <circle cx="12" cy="12" r="8.5" stroke="currentColor"/>
              <path d="M3 12c4-3 14-3 18 0" stroke="currentColor" stroke-linecap="round"/>
            </svg>
            Mahadasha Healing Offering
          </h3>
          <p>
            Offer <strong>{{ (result.get('mahadasha_frag_linked') or maha_frag) | safe }}</strong>
            in devotion to <em>{{ result.get('mahadasha','') }}</em> until <strong>{{ result.get('mahadasha_end','') }}</strong>.
          </p>
          <ul class="as-bullets">
            <li>Grounds intensity</li>
            <li>Fosters clarity</li>
            <li>Can be dedicated to <strong>Lord Hanuman</strong> or <strong>Lord Subramanya</strong></li>
          </ul>

          {% if result.get('mahadasha_frag_url') %}
            <p>
              <a class="as-cta" href="{{ result.get('mahadasha_frag_url') }}" target="_blank" rel="noopener">Add to Ritual</a>
              <a class="as-subtle-link" href="{{ result.get('mahadasha_frag_url') }}#details" target="_blank" rel="noopener">Learn more about this blend</a>
            </p>
          {% endif %}

          <div class="as-more">
            <button class="as-more-toggle" type="button"
              onclick="this.nextElementSibling.classList.toggle('as-hidden'); this.textContent = this.textContent.includes('Read') ? 'Hide full details' : 'Read full details';">
              Read full details
            </button>
            <div class="as-hidden">
              <div class="as-note"><p>This is more than a scent — it’s a <strong>guiding fragrance</strong>, unlocking the inner realms where your true path awaits.</p></div>
            </div>
          </div>
        </div>

        <!-- Antardasha ritual card -->
        <div class="as-ritual">
          <h3>
            <svg class="as-ico" viewBox="0 0 24 24" fill="none" aria-hidden="true">
              <circle cx="12" cy="12" r="8.5" stroke="currentColor"/>
              <path d="M6 9c4 2 8 2 12 0" stroke="currentColor" stroke-linecap="round"/>
            </svg>
            Antardasha Healing Offering
          </h3>
          <p>
            Offer <strong>{{ (result.get('antardasha_frag_linked') or anta_frag) | safe }}</strong>
            in reverence to <em>{{ result.get('antardasha','') }}</em>.
            If a {{ result.get('antardasha','') }} idol — representing {{ result.get('offering_to','') }} — is unavailable,
            invoke their presence through heartfelt intention before <strong>Lord Shiva</strong> until <strong>{{ result.get('antardasha_end','') }}</strong>.
          </p>

          {% if result.get('antardasha_frag_url') %}
            <p>
              <a class="as-cta" href="{{ result.get('antardasha_frag_url') }}" target="_blank" rel="noopener">View Offering</a>
              <a class="as-subtle-link" href="{{ result.get('antardasha_frag_url') }}#details" target="_blank" rel="noopener">Learn more about this blend</a>
            </p>
          {% endif %}
        </div>

        <div class="as-rule"></div>
      </section>

      <!-- Weak Planet -->
      <section class="as-section">
        {% if result.get('weak_planet') and (result.get('weak_fragrance_linked') or result.get('weak_fragrance')) %}
          <div class="as-ritual">
            <h3>
              <svg class="as-ico" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                <circle cx="12" cy="12" r="5.5" stroke="currentColor"/>
                <path d="M12 2v3M12 19v3M2 12h3M19 12h3M4.5 4.5l2.1 2.1M17.4 17.4l2.1 2.1M4.5 19.5l2.1-2.1M17.4 6.6l2.1-2.1" stroke="currentColor" stroke-linecap="round" stroke-width="1"/>
              </svg>
              Balancing a Weak {{ result.get('weak_planet','') }}
            </h3>
            <p>
              Apply <strong>{{ (result.get('weak_fragrance_linked') or result.get('weak_fragrance') or '') | safe }}</strong>
              to gently balance {{ result.get('weak_planet','') }}’s diminished influence.
            </p>
            <ul class="as-bullets">
              <li>{{ result.get('weak_healing_message','') }}</li>
              <li>Use during quiet breathwork or prayer to restore inner steadiness</li>
            </ul>

            {% if result.get('weak_fragrance_url') %}
              <p>
                <a class="as-cta" href="{{ result.get('weak_fragrance_url') }}" target="_blank" rel="noopener">
                  Experience {{ (result.get('weak_fragrance_linked') or result.get('weak_fragrance') or '') | striptags }}
                </a>
                <a class="as-subtle-link" href="{{ result.get('weak_fragrance_url') }}#details" target="_blank" rel="noopener">
                  Learn more about this blend
                </a>
              </p>
            {% endif %}
          </div>
        {% else %}
          <p class="as-muted"><em>No weak planet fragrance guidance available at the moment.</em></p>
        {% endif %}
      </section>

      <!-- Footer divider only -->
      <section class="as-section">
        <div class="as-divider" style="max-width:360px">◆</div>
      </section>

    </article>
  </div>

</body>
</html>
